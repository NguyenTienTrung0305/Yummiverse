detection_model:
  name: "yolov8s"
  pretrained: True
  classes: 18

freshness_model:
  type: "timm"
  name: "efficientnet_b2"
  pretrained: True
  classes: 3
  input_size: 224

training:
  detection:
    epochs: 300
    batch_size: 32
    img_size: 640
    patience: 50

  freshness:
    epochs: 100
    batch_size: 64
    img_size: 224
    patience: 20
    dropout: 0.3

    label_smoothing: 0.1
    ema_decay: 0.999
    amp: true # Automatic Mixed Precision

    mix_stop_ratio: 0.7
    use_mix: true
    mix_type: "cutmix"
    mix_prob: 0.35
    mix_alpha: 0.2

  device: "auto"
  workers: 8
  seed: 42
  folds: 5

# Data Paths
paths:
  detection_data: "data_detection.yaml"
  freshness_data: "datasets/freshness/"
  classifier_out_dir: runs/classifier
  detection_out_dir: runs/detection

# Optimizer
optimizer:
  detection:
    name: "AdamW"
    lr0: 0.01
    weight_decay: 0.0005

  freshness:
    name: "AdamW"
    lr_backbone: 1e-4
    lr_head: 1e-3
    warmup_ratio: 0.1
    div_factor: 25.0
    weight_decay: 0.0001

# Augmentation
augmentation:
  detection:
    hsv_h: 0.007
    hsv_s: 0.5
    hsv_v: 0.3
    degrees: 15.0
    fliplr: 0.5

    # turn on if have few data and in final epoch training
    mixup: 0.1
    copy_paste: 0.1
    mosaic: 0.8

  freshness:
    rotation: 15
    brightness: 0.2
    contrast: 0.2
    saturation: 0.15 # important for freshness
    hue: 0.03
    horizontal_flip: 0.5
    vertical_flip: 0.1
    blur_prob: 0.12
    noise_prob: 0.10
    shadow_prob: 0.10
    coarse_dropout_prob: 0.05

# Inference
inference:
  detection_confi: 0.4
  detection_iou: 0.5
  freshness_confi: 0.8
  crop_margin: 0.08 # expand crop box by 8%
  tta: true
  ensemble_folds: true
